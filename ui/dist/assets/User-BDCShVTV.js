import{_ as A,c as S,b as h,a as t,w as r,r as u,e as b,f as v,g as G,h as w,i as C,j as H,E as D,o as c,k as J,d as f,F as R,l as E}from"./index-tWRnQmOK.js";import{u as W}from"./utils-B12J7iWK.js";const X={name:"user",setup(){const l=G().appContext.config.globalProperties.$api,L=w({}),e=C([]),V=C([]),M=w([{label:"ID",prop:"id",width:"100"},{label:"用户名",prop:"userName",width:"180"},{label:"昵称",prop:"nickName",width:"180"},{label:"邮箱",prop:"email",width:"180"},{label:"手机号",prop:"phone",width:"120"}]),n=w({page:1,limit:10,total:0,username:""}),i=C("新增用户"),s=C(!1),g=w({roles:[]}),d=C(null),y=C([]),U=w({userName:[{required:!0,message:"请输入用户名称",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"}],nickName:[{required:!0,message:"请输入昵称",trigger:"blur"}],email:[{required:!0,message:"请输入用户邮箱",trigger:"blur"}],phone:[{required:!0,pattern:/1[3-9]\d{9}/,message:"请输入正确的手机号格式",trigger:"blur"}]}),m=async()=>{try{const{Items:o,Total:p}=await l.getUserList({page:n.page,limit:n.limit,username:n.username});e.value=o,n.total=p}catch(o){console.log("用户列表错误: ",o)}},k=o=>{n.limit=o,n.page=1,m()},F=o=>{n.page=o,m()},N=()=>{m()},z=async o=>{await l.delUser(o),D.success("用户删除成功"),m()},a=()=>{q(),s.value=!0,d.value.resetFields()},_=()=>{d.value.resetFields(),s.value=!1},T=async()=>{try{i.value!=="编辑用户"?(await d.value.validate(),await l.createUser(g),D.success("用户创建成功"),d.value.resetFields()):(await l.updateUser(g.id,g),D.success("用户更新成功")),s.value=!1,m()}catch(o){console.log(o)}},j=()=>{_()},K=o=>{q(),i.value="编辑用户",o.password="";const p={...o,roles:o.roles.map(x=>x.id)};Object.assign(g,p),s.value=!0},Q=async o=>{const p=o.id,x={status:o.status};await l.updateUser(p,x)},q=async()=>{let o=await l.getRoleList();y.value=o},P=o=>!o||o.length===0?[]:o.slice(0,2).map(p=>p.name),O=o=>!o||o.length===0?"无角色":o.map(p=>p.name).join(", "),B=()=>W.getMenuButton();return H(()=>{m(),V.value=B()}),{getMenuButton:B,getDisplayRoles:P,getRoleNames:O,buttons:V,dialogTitle:i,userList:e,user:L,columns:M,showModel:s,userForm:g,dialogForm:d,rules:U,roles:y,handleDialogClose:j,getUserList:m,pager:n,handleSizeChange:k,handleCurrentChange:F,handleQuery:N,delUser:z,createUser:a,createUserClose:_,createUserSubmit:T,updateUser:K,changeUserStatus:Q}}},Y={class:"user-manage"},Z={class:"query-form"},$={class:"base-table"},ee={class:"action"},le={class:"dialog-footer"};function ae(I,l,L,e,V,M){const n=u("el-input"),i=u("el-form-item"),s=u("el-button"),g=u("el-form"),d=u("el-table-column"),y=u("el-switch"),U=u("el-input-tag"),m=u("el-table"),k=u("el-pagination"),F=u("el-option"),N=u("el-select"),z=u("el-dialog");return c(),S("div",Y,[h("div",Z,[t(g,{inline:!0,model:e.pager},{default:r(()=>[t(i,null,{default:r(()=>[t(n,{modelValue:e.pager.username,"onUpdate:modelValue":l[0]||(l[0]=a=>e.pager.username=a),placeholder:"请输入用户名称",onKeyup:J(e.handleQuery,["enter"]),clearable:""},null,8,["modelValue","onKeyup"])]),_:1}),t(i,null,{default:r(()=>[t(s,{type:"primary",onClick:e.handleQuery},{default:r(()=>l[10]||(l[10]=[f("查询")])),_:1,__:[10]},8,["onClick"])]),_:1})]),_:1},8,["model"])]),h("div",$,[h("div",ee,[e.buttons.includes("userCreate")?(c(),b(s,{key:0,type:"primary",onClick:e.createUser},{default:r(()=>l[11]||(l[11]=[f("新增")])),_:1,__:[11]},8,["onClick"])):v("",!0)]),t(m,{data:e.userList,style:{width:"100%"}},{default:r(()=>[(c(!0),S(R,null,E(e.columns,a=>(c(),b(d,{key:a.prop,prop:a.prop,label:a.label,width:a.width,formatter:a.formatter},null,8,["prop","label","width","formatter"]))),128)),t(d,{label:"状态",width:"100"},{default:r(a=>[t(y,{modelValue:a.row.status,"onUpdate:modelValue":_=>a.row.status=_,"active-value":1,"inactive-value":2,onChange:_=>e.changeUserStatus(a.row)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),t(d,{label:"角色",width:"150"},{default:r(a=>[a.row.roles.length>0?(c(),b(U,{key:0,"model-value":e.getDisplayRoles(a.row.roles),disabled:""},null,8,["model-value"])):v("",!0)]),_:1}),t(d,{label:"操作","min-width":"200",fixed:"right"},{default:r(a=>[t(s,{type:"primary",size:"small"},{default:r(()=>l[12]||(l[12]=[f(" 详情 ")])),_:1,__:[12]}),e.buttons.includes("userEdit")?(c(),b(s,{key:0,type:"primary",size:"small",onClick:_=>e.updateUser(a.row)},{default:r(()=>l[13]||(l[13]=[f("编辑")])),_:2,__:[13]},1032,["onClick"])):v("",!0),e.buttons.includes("userDelete")?(c(),b(s,{key:1,type:"danger",size:"small",onClick:_=>e.delUser(a.row.id)},{default:r(()=>l[14]||(l[14]=[f("删除")])),_:2,__:[14]},1032,["onClick"])):v("",!0)]),_:1})]),_:1},8,["data"]),t(k,{class:"pagination",background:"",layout:"total, sizes, prev, pager, next",total:e.pager.total,"page-sizes":[1,5,10,20],"page-size":e.pager.limit,"onUpdate:pageSize":l[1]||(l[1]=a=>e.pager.limit=a),"current-page":e.pager.page,"onUpdate:currentPage":l[2]||(l[2]=a=>e.pager.page=a),onSizeChange:e.handleSizeChange,onCurrentChange:e.handleCurrentChange},null,8,["total","page-size","current-page","onSizeChange","onCurrentChange"])]),t(z,{title:e.dialogTitle,modelValue:e.showModel,"onUpdate:modelValue":l[9]||(l[9]=a=>e.showModel=a),onClose:e.handleDialogClose},{footer:r(()=>[h("div",le,[t(s,{onClick:e.createUserClose},{default:r(()=>l[15]||(l[15]=[f("取消")])),_:1,__:[15]},8,["onClick"]),t(s,{type:"primary",onClick:e.createUserSubmit},{default:r(()=>l[16]||(l[16]=[f("确定")])),_:1,__:[16]},8,["onClick"])])]),default:r(()=>[t(g,{model:e.userForm,ref:"dialogForm","label-width":"100px",rules:e.rules},{default:r(()=>[t(i,{label:"用户名",prop:"userName"},{default:r(()=>[t(n,{modelValue:e.userForm.userName,"onUpdate:modelValue":l[3]||(l[3]=a=>e.userForm.userName=a),placeholder:"请输入用户名"},null,8,["modelValue"])]),_:1}),t(i,{label:"昵称",prop:"nickName"},{default:r(()=>[t(n,{modelValue:e.userForm.nickName,"onUpdate:modelValue":l[4]||(l[4]=a=>e.userForm.nickName=a),placeholder:"请输入昵称"},null,8,["modelValue"])]),_:1}),t(i,{label:"密码"},{default:r(()=>[t(n,{modelValue:e.userForm.password,"onUpdate:modelValue":l[5]||(l[5]=a=>e.userForm.password=a),placeholder:"请输入密码"},null,8,["modelValue"])]),_:1}),t(i,{label:"邮箱",prop:"email"},{default:r(()=>[t(n,{modelValue:e.userForm.email,"onUpdate:modelValue":l[6]||(l[6]=a=>e.userForm.email=a),placeholder:"请输入邮箱"},null,8,["modelValue"])]),_:1}),t(i,{label:"手机号",prop:"phone"},{default:r(()=>[t(n,{modelValue:e.userForm.phone,"onUpdate:modelValue":l[7]||(l[7]=a=>e.userForm.phone=a),placeholder:"请输入手机号"},null,8,["modelValue"])]),_:1}),t(i,{label:"角色",prop:"roles"},{default:r(()=>[t(N,{modelValue:e.userForm.roles,"onUpdate:modelValue":l[8]||(l[8]=a=>e.userForm.roles=a),placeholder:"请选择角色",multiple:"",style:{width:"100%"}},{default:r(()=>[(c(!0),S(R,null,E(e.roles,a=>(c(),b(F,{key:a.id,label:a.name,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["title","modelValue","onClose"])])}const re=A(X,[["render",ae]]);export{re as default};
