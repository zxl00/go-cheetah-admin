import{u as F,g as C}from"./utils-B12J7iWK.js";import{_ as S,c as k,b as w,a as n,e as i,f as d,w as o,r as u,o as r,d as a,F as A,l as N}from"./index-tWRnQmOK.js";const z={name:"Menu",data(){return{showModel:!1,dialogTitle:"新增菜单",menusList:[],createMenuList:[],buttons:[],rules:{name:[{required:!0,message:"请输入菜单名称",trigger:"blur"},{min:2,max:20,message:"长度在2-8个字符",trigger:"blur"}]},menusForm:{is_show:1},menuType:{is_menu:2},columns:[{label:"菜单名称",prop:"name",width:180},{label:"图标",prop:"icon"},{label:"路由地址",prop:"path"},{label:"组件路径",prop:"component"},{label:"创建人",prop:"create_by"},{label:"创建时间",prop:"formattedCreatedAt",width:200}]}},mounted(){this.getMenuList(),this.buttons=this.getMenuButton()},methods:{async getMenuList(){try{let s=await this.$api.getMenuList();const e=c=>{c.forEach(p=>{p.formattedCreatedAt=F.formatDate(p.CreatedAt),p.children&&e(p.children)})};e(s),this.menusList=s}catch(s){console.log(s)}},createMenu(){this.dialogTitle="新增菜单",this.showModel=!0},async delMenus(s){await this.$api.delMenu(s),await this.getMenuList()},updateMenus(s){Object.assign(this.menusForm,s),this.menuType.is_menu=s.menu_type,this.dialogTitle="编辑菜单",this.showModel=!0},createMenusClose(){this.showModel=!1,this.$refs.dialogForm.resetFields()},async createMenusSubmit(){try{if(this.dialogTitle==="编辑菜单"){const s=C(this.menusForm.parent_id||[]);this.menusForm.parent_id=s,await this.$api.updateMenu(this.menusForm.id,this.menusForm)}else{await new Promise((e,c)=>{this.$refs.dialogForm.validate(p=>{p?e():c()})});const s=C(this.menusForm.parent_id||[]);this.menusForm.parent_id=s,this.menusForm.menu_type=this.menuType.is_menu,await this.$api.createMenu(this.menusForm)}await this.getMenuList(),this.showModel=!1,this.$refs.dialogForm.resetFields()}catch(s){console.error("操作失败:",s)}},handleDialogClose(){this.createMenusClose()},async changeMenuStatus(s){try{await this.$api.updateMenu(s.id,s)}catch{}},handleChange(s){this.$api.updateMenu(s.id,s)},getMenuButton(){return F.getMenuButton()},filterButtonMenus(s){return s.filter(e=>e.menu_type===1?!1:(e.children&&e.children.length>0&&(e.children=this.filterButtonMenus(e.children)),!0))}}},E={class:"user-manage"},I={class:"base-table"},j={class:"action"},q={class:"dialog-footer"};function O(s,e,c,p,t,m){const h=u("el-button"),b=u("el-table-column"),v=u("el-input-number"),M=u("el-tag"),T=u("el-switch"),L=u("el-popconfirm"),U=u("el-table"),B=u("el-cascader"),_=u("el-form-item"),g=u("el-radio"),V=u("el-radio-group"),y=u("el-input"),x=u("el-form"),D=u("el-dialog");return r(),k("div",E,[w("div",I,[w("div",j,[t.buttons.includes("menuCreate")?(r(),i(h,{key:0,type:"primary",onClick:m.createMenu},{default:o(()=>e[8]||(e[8]=[a("新增")])),_:1,__:[8]},8,["onClick"])):d("",!0)]),n(U,{data:t.menusList,"row-key":"id"},{default:o(()=>[(r(!0),k(A,null,N(t.columns,l=>(r(),i(b,{key:l.prop,prop:l.prop,label:l.label,width:l.width},null,8,["prop","label","width"]))),128)),n(b,{label:"排序",width:"150"},{default:o(l=>[n(v,{disabled:!t.buttons.includes("menuSort"),modelValue:l.row.sort,"onUpdate:modelValue":f=>l.row.sort=f,size:"small",onChange:f=>m.handleChange(l.row)},null,8,["disabled","modelValue","onUpdate:modelValue","onChange"])]),_:1}),n(b,{label:"菜单类型"},{default:o(l=>[l.row.menu_type===1?(r(),i(M,{key:0,effect:"danger"},{default:o(()=>e[9]||(e[9]=[a("按钮")])),_:1,__:[9]})):l.row.menu_type===2?(r(),i(M,{key:1},{default:o(()=>e[10]||(e[10]=[a("菜单")])),_:1,__:[10]})):d("",!0)]),_:1}),n(b,{label:"菜单状态"},{default:o(l=>[n(T,{disabled:!t.buttons.includes("menuStatus"),modelValue:l.row.is_show,"onUpdate:modelValue":f=>l.row.is_show=f,"active-value":1,"inactive-value":2,onChange:f=>m.changeMenuStatus(l.row)},null,8,["disabled","modelValue","onUpdate:modelValue","onChange"])]),_:1}),n(b,{label:"操作","min-width":"150",fixed:"right"},{default:o(l=>[t.buttons.includes("menuEdit")?(r(),i(h,{key:0,type:"primary",size:"small",onClick:f=>m.updateMenus(l.row)},{default:o(()=>e[11]||(e[11]=[a("编辑")])),_:2,__:[11]},1032,["onClick"])):d("",!0),n(L,{title:"确定删除菜单吗?",onConfirm:f=>m.delMenus(l.row.id)},{reference:o(()=>[t.buttons.includes("menuDelete")?(r(),i(h,{key:0,type:"danger",size:"small"},{default:o(()=>e[12]||(e[12]=[a("删除")])),_:1,__:[12]})):d("",!0)]),_:2},1032,["onConfirm"])]),_:1})]),_:1},8,["data"])]),n(D,{title:t.dialogTitle,modelValue:t.showModel,"onUpdate:modelValue":e[7]||(e[7]=l=>t.showModel=l),onClose:m.handleDialogClose},{footer:o(()=>[w("div",q,[n(h,{onClick:m.createMenusClose},{default:o(()=>e[17]||(e[17]=[a("取消")])),_:1,__:[17]},8,["onClick"]),n(h,{type:"primary",onClick:m.createMenusSubmit},{default:o(()=>e[18]||(e[18]=[a("确定")])),_:1,__:[18]},8,["onClick"])])]),default:o(()=>[n(x,{model:t.menusForm,ref:"dialogForm","label-width":"100px",rules:t.rules},{default:o(()=>[n(_,{label:"父级菜单",prop:"parent_id"},{default:o(()=>[n(B,{modelValue:t.menusForm.parent_id,"onUpdate:modelValue":e[0]||(e[0]=l=>t.menusForm.parent_id=l),options:t.menusList,props:{checkStrictly:!0,value:"id",label:"name"},placeholder:"默认为顶级菜单",clearable:""},null,8,["modelValue","options"])]),_:1}),n(_,{label:"菜单类型",prop:"menu_type"},{default:o(()=>[n(V,{modelValue:t.menuType.is_menu,"onUpdate:modelValue":e[1]||(e[1]=l=>t.menuType.is_menu=l)},{default:o(()=>[n(g,{label:"1",value:1},{default:o(()=>e[13]||(e[13]=[a("按钮")])),_:1,__:[13]}),n(g,{label:"2",value:2},{default:o(()=>e[14]||(e[14]=[a("菜单")])),_:1,__:[14]})]),_:1},8,["modelValue"])]),_:1}),n(_,{label:"名称",prop:"name"},{default:o(()=>[n(y,{modelValue:t.menusForm.name,"onUpdate:modelValue":e[2]||(e[2]=l=>t.menusForm.name=l),placeholder:"请输入菜单/按钮名称"},null,8,["modelValue"])]),_:1}),t.menuType.is_menu===2?(r(),i(_,{key:0,label:"图标",prop:"icon"},{default:o(()=>[n(y,{modelValue:t.menusForm.icon,"onUpdate:modelValue":e[3]||(e[3]=l=>t.menusForm.icon=l),placeholder:"请输入菜单图标"},null,8,["modelValue"])]),_:1})):d("",!0),t.menuType.is_menu===2?(r(),i(_,{key:1,label:"路由地址",prop:"path"},{default:o(()=>[n(y,{modelValue:t.menusForm.path,"onUpdate:modelValue":e[4]||(e[4]=l=>t.menusForm.path=l),placeholder:"请输入路由地址"},null,8,["modelValue"])]),_:1})):d("",!0),t.menuType.is_menu===2?(r(),i(_,{key:2,label:"组件路径",prop:"component"},{default:o(()=>[n(y,{modelValue:t.menusForm.component,"onUpdate:modelValue":e[5]||(e[5]=l=>t.menusForm.component=l),placeholder:"请输入组件路径"},null,8,["modelValue"])]),_:1})):d("",!0),t.menuType.is_menu===2?(r(),i(_,{key:3,label:"菜单状态",prop:"is_show"},{default:o(()=>[n(V,{modelValue:t.menusForm.is_show,"onUpdate:modelValue":e[6]||(e[6]=l=>t.menusForm.is_show=l)},{default:o(()=>[n(g,{label:"1",value:1},{default:o(()=>e[15]||(e[15]=[a("正常")])),_:1,__:[15]}),n(g,{label:"2",value:2},{default:o(()=>e[16]||(e[16]=[a("禁用")])),_:1,__:[16]})]),_:1},8,["modelValue"])]),_:1})):d("",!0)]),_:1},8,["model","rules"])]),_:1},8,["title","modelValue","onClose"])])}const H=S(z,[["render",O]]);export{H as default};
