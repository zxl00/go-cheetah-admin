import{u as L}from"./utils-B12J7iWK.js";import{_ as M,c as _,b as c,a as o,w as i,r as a,e as m,f,o as s,d,F as y,l as w}from"./index-tWRnQmOK.js";const T={name:"Api",data(){return{showModel:!1,dialogTitle:"新增接口",buttons:[],apiList:[],apiForm:{},menusList:[],options:[{value:"GET",label:"GET"},{value:"POST",label:"POST"}],pager:{desc:""},rules:{path:[{required:!0,message:"请输入请求路径",trigger:"blur"}],method:[{required:!0,message:"请选择请求方法",trigger:"change"}],apiGroup:[{required:!0,message:"请输入归属菜单",trigger:"blur"}]},columns:[{label:"ID",prop:"id",width:100},{label:"路径",prop:"path"},{label:"方法",prop:"method"},{label:"描述",prop:"desc"},{label:"归属菜单",prop:"apiGroup"}]}},mounted(){this.getApiList(),this.getMenuList(),this.buttons=this.getMenuButton()},methods:{async getApiList(){try{const r=await this.$api.getApiList();this.apiList=r}catch(r){console.log(r)}},createApi(){this.dialogTitle="新增接口",this.showModel=!0},async getMenuList(){try{let r=await this.$api.getMenuList();this.menusList=this.filterButtonMenus(r)}catch(r){console.log(r)}},filterButtonMenus(r){return r.filter(e=>e.menu_type===1?!1:(e.children&&e.children.length>0&&(e.children=this.filterButtonMenus(e.children)),!0))},async createApiSubmit(){try{await this.$refs.dialogForm.validate(),this.dialogTitle==="编辑接口"?(console.log("等待实现"),await this.$api.updateApi(this.apiForm.id,this.apiForm)):await this.$api.createApi(this.apiForm),await this.getApiList(),this.createApiClose()}catch(r){console.error("提交失败:",r)}},createApiClose(){this.showModel=!1,this.$refs.dialogForm.resetFields()},updateApi(r){Object.assign(this.apiForm,r),this.dialogTitle="编辑接口",this.showModel=!0},async delApi(r){try{await this.$confirm("确定要删除该接口吗？","提示",{type:"warning"}),await this.$api.delApi(r),await this.getApiList()}catch(e){console.log(e)}},handleDialogClose(){this.createApiClose()},getMenuButton(){return L.getMenuButton()},handleQuery(){alert("TODO 下个版本迭代")}}},B={class:"user-manage"},x={class:"query-form"},G={class:"base-table"},U={class:"action"},D={class:"dialog-footer"};function O(r,e,S,q,t,n){const h=a("el-input"),p=a("el-form-item"),u=a("el-button"),g=a("el-form"),b=a("el-table-column"),C=a("el-table"),A=a("el-option"),V=a("el-select"),k=a("el-cascader"),F=a("el-dialog");return s(),_("div",B,[c("div",x,[o(g,{inline:!0,model:t.pager},{default:i(()=>[o(p,null,{default:i(()=>[o(h,{modelValue:t.pager.desc,"onUpdate:modelValue":e[0]||(e[0]=l=>t.pager.desc=l),placeholder:"请输入描述信息"},null,8,["modelValue"])]),_:1}),o(p,null,{default:i(()=>[o(u,{type:"primary",onClick:n.handleQuery},{default:i(()=>e[6]||(e[6]=[d("查询")])),_:1,__:[6]},8,["onClick"])]),_:1})]),_:1},8,["model"])]),c("div",G,[c("div",U,[t.buttons.includes("apiCreate")?(s(),m(u,{key:0,type:"primary",onClick:n.createApi},{default:i(()=>e[7]||(e[7]=[d("新增")])),_:1,__:[7]},8,["onClick"])):f("",!0)]),o(C,{data:t.apiList},{default:i(()=>[(s(!0),_(y,null,w(t.columns,l=>(s(),m(b,{key:l.prop,prop:l.prop,label:l.label,width:l.width,formatter:l.formatter},null,8,["prop","label","width","formatter"]))),128)),o(b,{label:"操作","min-width":"150"},{default:i(l=>[t.buttons.includes("apiEdit")?(s(),m(u,{key:0,type:"primary",size:"small",onClick:v=>n.updateApi(l.row)},{default:i(()=>e[8]||(e[8]=[d("编辑")])),_:2,__:[8]},1032,["onClick"])):f("",!0),t.buttons.includes("apiDelete")?(s(),m(u,{key:1,type:"danger",size:"small",onClick:v=>n.delApi(l.row.id)},{default:i(()=>e[9]||(e[9]=[d("删除")])),_:2,__:[9]},1032,["onClick"])):f("",!0)]),_:1})]),_:1},8,["data"])]),o(F,{title:t.dialogTitle,modelValue:t.showModel,"onUpdate:modelValue":e[5]||(e[5]=l=>t.showModel=l),onClose:n.handleDialogClose},{footer:i(()=>[c("div",D,[o(u,{onClick:n.createApiClose},{default:i(()=>e[10]||(e[10]=[d("取消")])),_:1,__:[10]},8,["onClick"]),o(u,{type:"primary",onClick:n.createApiSubmit},{default:i(()=>e[11]||(e[11]=[d("确定")])),_:1,__:[11]},8,["onClick"])])]),default:i(()=>[o(g,{model:t.apiForm,ref:"dialogForm","label-width":"100px",rules:t.rules},{default:i(()=>[o(p,{label:"路径",prop:"path"},{default:i(()=>[o(h,{modelValue:t.apiForm.path,"onUpdate:modelValue":e[1]||(e[1]=l=>t.apiForm.path=l),placeholder:"请输入请求路径"},null,8,["modelValue"])]),_:1}),o(p,{label:"方法",prop:"method"},{default:i(()=>[o(V,{modelValue:t.apiForm.method,"onUpdate:modelValue":e[2]||(e[2]=l=>t.apiForm.method=l),placeholder:"请选择请求方法",style:{width:"240px"}},{default:i(()=>[(s(!0),_(y,null,w(t.options,l=>(s(),m(A,{key:l.value,label:l.label,value:l.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),o(p,{label:"描述"},{default:i(()=>[o(h,{modelValue:t.apiForm.desc,"onUpdate:modelValue":e[3]||(e[3]=l=>t.apiForm.desc=l),placeholder:"请输入描述"},null,8,["modelValue"])]),_:1}),o(p,{label:"归属菜单",prop:"apiGroup"},{default:i(()=>[o(k,{modelValue:t.apiForm.apiGroup,"onUpdate:modelValue":e[4]||(e[4]=l=>t.apiForm.apiGroup=l),options:t.menusList,props:{checkStrictly:!0,value:"name",label:"name",emitPath:!1},"show-all-levels":!1,clearable:""},null,8,["modelValue","options"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["title","modelValue","onClose"])])}const P=M(T,[["render",O]]);export{P as default};
